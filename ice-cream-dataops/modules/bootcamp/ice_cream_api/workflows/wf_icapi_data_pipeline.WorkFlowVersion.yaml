workflowExternalId: wf_icapi_data_pipeline
version: '1'
workflowDefinition:
  tasks:
  - externalId: create_asset_hierarchy_task
    type: transformation
    parameters:
      transformation:
        externalId: create_asset_hierarchy
        concurrencyPolicy: fail
    retries: 3
    timeout: 3600
    onFailure: abortWorkflow
 
  - externalId: contextualize_ts_assets_task
    type: transformation
    parameters:
      transformation:
        externalId: contextualize_ts_assets
        concurrencyPolicy: fail
    retries: 3
    timeout: 3600
    onFailure: abortWorkflow
    dependsOn:
      - externalId: create_asset_hierarchy_task
 
  - externalId: icapi_datapoints_extractor_task
    type: function
    parameters:
      function:
        externalId: icapi_datapoints_extractor
        data:
          sites: ["Sao_Paulo","Houston","Oslo","Kuala_Lumpur","Hannover","Nuremberg","Marseille","Chicago","Rotterdam","London"] 
          hours: 336
          backfill: true
    retries: 3
    timeout: 3600
    onFailure: abortWorkflow
    dependsOn:
      - externalId: contextualize_ts_assets_task
 
  - externalId: oee_timeseries
    type: function
    parameters:
      function:
        externalId: oee_timeseries
        data: 
          sites: ["Houston","Oslo","Kuala_Lumpur","Hannover","Nuremberg","Marseille","Sao_Paulo","Chicago","Rotterdam","London"]
          lookback_minutes: 10160
    retries: 3
    timeout: 3600
    onFailure: abortWorkflow
    dependsOn:
      - externalId: icapi_datapoints_extractor_task